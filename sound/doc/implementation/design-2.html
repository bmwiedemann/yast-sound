<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>YaST2: Sound configuration: Functions and global variables</TITLE>
 <LINK HREF="design-3.html" REL=next>
 <LINK HREF="design-1.html" REL=previous>
 <LINK HREF="design.html#toc2" REL=contents>
</HEAD>
<BODY>
<A HREF="design-3.html">Next</A>
<A HREF="design-1.html">Previous</A>
<A HREF="design.html#toc2">Contents</A>
<HR>
<H2><A NAME="s2">2. Functions and global variables</A></H2>

<P>Here is the description of all functions used in all
modules (in alphabetical order):
<P>
<H2><A NAME="ss2.1">2.1 ConfModules (string file)</A>
</H2>

<P>This function modifies <CODE>/etc/modules.conf</CODE>. If first uses
``sed'' script commenting out all possible old settings. Than using
anyagent reads all lines in this file and tries to remove lines
previously inserted by this tool. Than it appends few lines with all
necessary entries for configured card (as was mentioned before).
<P>
<H3>Return value</H3>

<P>String with error message to display (if an error occurred), empty
string if saving was successful.
<P>
<H2><A NAME="ss2.2">2.2 DBNotFound ()</A>
</H2>

<P>Simple dialog that is displayed if the sound card database can not be
read.
<P>
<H3>Return value</H3>

<P>id of pressed button (`next or `back or `cancel)
<P>
<H2><A NAME="ss2.3">2.3 DisplayFound (void|list found)</A>
</H2>

<P>Dialog that displays what was found.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>found </B><DD><P>list of found cards, nil if no sound cards were found.
</DL>
<P>
<H3>Return value</H3>

<P>Map of card info that was selected to configure.
<P>
<H2><A NAME="ss2.4">2.4 DisplayMessage (string message, integer code, string stack)</A>
</H2>

<P>Simple ``UI'' popup dialog used for displaying especially error
messages.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>message </B><DD><P>message to display
<DT><B>code </B><DD><P>optional warning dialog text (errcode)
<DT><B>stack </B><DD><P>message to display
</DL>
<P>
<H3>Return value</H3>

<P>none
<P>
<H2><A NAME="ss2.5">2.5 DisplayYesNo (string message)</A>
</H2>

<P>Simple ``UI'' popup dialog used for user input to Yes/No answer. 
<H3>Return value</H3>

<P>1 if yes was pressed, 0 otherwise
<P>
<H2><A NAME="ss2.6">2.6 SetContents (string title, term contents, string helptext, boolean has_back, boolean has_next)</A>
</H2>

<P>The main ``UI''dialog. Copied from installation.ycp.
<P>
<H3>Return value</H3>

<P>none
<P>
<H2><A NAME="ss2.7">2.7 FindCard ()</A>
</H2>

<P>First dialog. Displays ``Searching for a sound card'' and calls
<CODE>GetAudio ()</CODE> function.
<P>
<H3>Return value</H3>

<P>id of pressed button (`next or `back or `cancel)
<P>
<H2><A NAME="ss2.8">2.8 GetAudio ()</A>
</H2>

<P>Simple reads ``.probe.byclass.multimedia.audio'' SCR path and calls
<CODE>remove_duplicates()</CODE> that removes entries with the same id's.
<P>
<H3>Return value</H3>

<P>list of found sound cards, empty list if no cards were found.
<P>
<P>
<H2><A NAME="ss2.9">2.9 GetCards (string module_name, list db)</A>
</H2>

<P>Lookups in the sound cards database for the sound cards listed in
<CODE>module_name</CODE> module.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>module_name </B><DD><P>module name to look for
<DT><B>db </B><DD><P>database
</DL>
<P>
<H3>Return value</H3>

<P>Sorted list of sound cards, empty list if nothing was found.
<P>
<H2><A NAME="ss2.10">2.10 IsAlsaInstalled ()</A>
</H2>

<P>By calling ``rpm'' tests if ALSA package is installed.
<P>
<H3>Return value</H3>

<P>true/false is/isn't installed 
<P>
<H2><A NAME="ss2.11">2.11 NotInstalled ()</A>
</H2>

<P>Dialog that is displayed when ALSA package is not installed.
<P>
<H3>Return value</H3>

<P>none
<P>
<H2><A NAME="ss2.12">2.12 QuitAllSoundPrograms ()</A>
</H2>

<P>Asks user to terminate all programs that use some of sound device. It
is used, when user wants to reset the previous configuration and such
programs are running. If the answer is yes than kills all such
programs.
<P>
<H3>Return value</H3>

<P>true if no such programs are running, false if some are running.
<P>
<H2><A NAME="ss2.13">2.13 SearchForCard (string name)</A>
</H2>

<P>Looks up in the database for first occurrence of a sound card that
begins with string ``name''.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>name </B><DD><P>string to look up for
</DL>
<P>
<H3>Return value</H3>

<P>map with sound card driver (module) that contains first sound card
that begins with ``name''.
<P>
<H2><A NAME="ss2.14">2.14 SetContents (string title, term contents, string helptext, boolean has_back, boolean has_next)</A>
</H2>

<P>The main dialog. Copied from installation.ycp.
<P>
<H3>Return value</H3>

<P>none
<P>
<H2><A NAME="ss2.15">2.15 Trans (map|void msgs, string lang)</A>
</H2>

<P>Chooses one message according to the language, used for translating
sndcard options.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>msgs </B><DD><P>message to translate
<DT><B>lang </B><DD><P>language
</DL>
<P>
<H3>Return value</H3>

<P>translated message
<P>
<H2><A NAME="ss2.16">2.16 add_keys (list orig, list to_add, string key)</A>
</H2>

<P>Concatenates two lists (both contains strings) this way: creates new
list, where the item concatenation of string contained in the lists
these list should be the same length. This is used for appending
strings to all string in the list.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>orig</B><DD><P>list of maps
<DT><B>to_add</B><DD><P>ist (same lenght) of new values that will be added to each
map with 'key' key
<DT><B>key</B><DD><P>key to append
</DL>
<P>
<H3>Return value</H3>

<P>Concatenated list.
<P>
<H3>check_value (string value, string type, list poss)</H3>

<P>1st: checks if value is type (``int'' or ``string'',
2nd: if poss is nonempty, checks if value is one of them.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>value</B><DD><P>value to check
<DT><B>type</B><DD><P>type to check value for
<DT><B>poss</B><DD><P>list of possible values
</DL>
<P>
<H3>Return valuereturns error message, empty string if ok</H3>

<H2><A NAME="ss2.17">2.17 condition (boolean c, any s1, any s2)</A>
</H2>

<P>This is equivalent to the ``?'' (ternary condition) operator in C.
It simply states: <CODE>if c then s1 else s2</CODE>.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>c</B><DD><P>condition, which can evaluate to boolean
<DT><B>s1</B><DD><P>statement if c evaluates to true
<DT><B>s2</B><DD><P>statement if c evaluates to false
</DL>
<P>
<H2><A NAME="ss2.18">2.18 define create_table (list lm, list lk)</A>
</H2>

<P>Creates itemized table entries,
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>lm</B><DD><P>list of maps to take keys from
<DT><B>lk</B><DD><P>list of keys to look for in 1st param
</DL>
<P>
<H3>Return value</H3>

<P>Itemized list of table entries.
<P>
<P>
<H2><A NAME="ss2.19">2.19 get_module (string bus, integer vendor_id, integer device_id)</A>
</H2>

<P>Looks-up for a kernel module for this bus, vendor_id, device_id sound
card.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>bus</B><DD><P>bus type (``isa'', ``pci''
<DT><B>vendor_id</B><DD><P>vendor id
<DT><B>device_id</B><DD><P>device id
</DL>
<P>
<P>
<H3>Return value</H3>

<P>Map with complete module info (name, options, etc...)
<P>
<P>
<H2><A NAME="ss2.20">2.20 hextoi (string num)</A>
</H2>

<P>Converts hex num to integer keeps decimal number as is. Hexadecimal
number assumes to have prefix ``0x''. Doesn't  check the syntax.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>num </B><DD><P>string that contains decimal or hexadecimal number
</DL>
<P>
<H3>Return value</H3>

<P>Converted number.
<P>
<H2><A NAME="ss2.21">2.21 itemize_list (list l, integer sel)</A>
</H2>

<P>Creates list [`item (`id(0), &lt;element&gt;), `item (`id (1), &lt;element&gt;),
...] where sel is marked with true these items are usable in the
selection boxes.
<P>
<H3>Return value</H3>

<P>``itemized'' list.
<P>
<H2><A NAME="ss2.22">2.22 parse_values (string des)</A>
</H2>

<P>Tries to extract list of values from description
these value are generated from alsa modules
and can be in form [list=value,value,..] or
[range=1-19] or something not recognized.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>des</B><DD><P>Part of description from alsa module info.
</DL>
<P>
<H3>Return value</H3>

<P>List of possible values, empty if unrecognized.
<P>
<H2><A NAME="ss2.23">2.23 probe_module (map snd_info)</A>
</H2>

<P>Tries to insert module with options (if any)
returns string with error message (empty string if ok).
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>snd_info</B><DD><P>Module info (name, oprions, etc...)
</DL>
<P>
<H3>Return value</H3>

<P>String with error message, empty if ok.
<P>
<H2><A NAME="ss2.24">2.24 remove_duplicates (list l)</A>
</H2>

<P>Creates new list from list l, but cards with the same device/vendor id
are added just once.
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B>l </B><DD><P>list of sound cards returned by libhd.
</DL>
<P>
<H3>Return value</H3>

<P>``clean'' list
<P>
<P>
<H2><A NAME="ss2.25">2.25 save ()</A>
</H2>

<P>1. depmode 2. save modules.conf 3. depmode 4. alsactl store
<P>
<H3>Return value</H3>

<P>String with error message, empty if ok.
<P>
<H2><A NAME="ss2.26">2.26 set_volume (integer v)</A>
</H2>

<P>Sets the volume, with amixer check if an error occurs popup error is
displayed
<P>
<H3>Parameters</H3>

<P>
<DL>
<DT><B> v</B><DD><P>volume value
</DL>
<P>
<H3>Return value</H3>

<P>return shell exit code
<P>
<H2><A NAME="ss2.27">2.27 soundcard_name (map device)</A>
</H2>

<P>Extracts sound card name from map read from SCR, if none returns
``Unknown name''
<P>
<H3>Return value</H3>

<P>Name of sound card.
<P>
<P>
<H2><A NAME="ss2.28">2.28 unmute_all (integer vol)</A>
</H2>

<P>Unmute all devices to vol. Devices are read with anyagent by calling
amixer.
<P>
<H3>Return value</H3>

<P>none
<P>
<H2><A NAME="ss2.29">2.29 Global Variables</A>
</H2>

<P>
<DL>
<DT><B>help_text (<I>string</I>)</B><DD><P>Variable containing help text.
<DT><B>database_name (<I>string</I>)</B><DD><P>Name of sound card database to use.
<DT><B>cont (<I>boolean</I>)</B><DD><P>Conditional variable for loops.
<DT><B>snd_info (<I>map</I>)</B><DD><P>information about module.
<DT><B>selected_manually (<I>boolean</I>)</B><DD><P>Informs if the cards was
selected manually.
<DT><B>found (<I>list</I>)</B><DD><P>List of what was found by libhd.
<DT><B>options_entered (<I>map</I>)</B><DD><P>Currently entered options.
<DT><B>already (<I>any</I>)</B><DD><P>contains info about already configured
sound cards.
</DL>
<P>
<HR>
<A HREF="design-3.html">Next</A>
<A HREF="design-1.html">Previous</A>
<A HREF="design.html#toc2">Contents</A>
</BODY>
</HTML>
