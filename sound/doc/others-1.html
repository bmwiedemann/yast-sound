<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
<HTML>
<HEAD>
 <META NAME="GENERATOR" CONTENT="SGML-Tools 1.0.9">
 <TITLE>Sound configuration with alsa and sndconfig: Sound card (auto)detection</TITLE>
 <LINK HREF="others-2.html" REL=next>

 <LINK HREF="others.html#toc1" REL=contents>
</HEAD>
<BODY>
<A HREF="others-2.html">Next</A>
Previous
<A HREF="others.html#toc1">Contents</A>
<HR>
<H2><A NAME="s1">1. Sound card (auto)detection</A></H2>

<P><I>requires:</I> sound card, alsaconf or sndconfig
<P><I>provides:</I> sound card auto-detection
<P>
<H2><A NAME="alsa-conf"></A> <A NAME="ss1.1">1.1 Alsa-conf</A>
</H2>

<P>There are two different version of alsaconf. First one is a shell
script (written by 
<A HREF="mailto:ondrejj@salstar.shadow.sk">Jan ONDREJ</A>).  The second one, still in alfa state development,
is a part of 
<A HREF="http://www.alsa-project.org/">alsa project</A> and it should replace shell script version.
<P>
<H3><A NAME="alsa-conf shell"></A> Alsaconf -- shell script</H3>

<P>
<OL>
<LI>It tries to auto-detect the sound card with use of
snd-detect module.</LI>
<LI>If it finds some, it will offer you its values and will
detect the next one.</LI>
<LI>If it did not find a sound card, it will offer you the
sound card list.</LI>
</OL>
<P>Primary site: 
<A HREF="ftp://ftp.alsa-project.org/pub/driver/alsaconf">ftp://ftp.alsa-project.org/pub/driver/alsaconf</A>.
<P>
<P><I>requires:</I> these tools: dialog or whiptail, awk;
modules: snd-detect, snd-card-* (see 
<A HREF="others-5.html#alsa-driver modules">alsa-driver modules</A> for complete list).
<P>
<P><I>provides:</I> auto-detection of the sound card, list of sound
cards.
<P>
<H3>Steps made by alsaconf</H3>

<P>
<OL>
<LI>You must be root to use this script.</LI>
<LI>The script tries to auto-detect sound card using
<CODE>snd-detect</CODE> module</LI>
<LI>For each detected sound card follows number of dialogs,
depending on sound card (each offers default values).</LI>
<LI>Then the dialog with list of sound cards (with option <I>No
more cards</I>) is displayed.</LI>
<LI>For each selected sound card follows number of dialogs,
depending on sound card (each offers default values).</LI>
<LI>After selecting <I>No more cards</I> asks if
<CODE>/etc/conf.modules</CODE> should be modified.</LI>
<LI>If yes is selected it writes something like this:
<HR>
<PRE>
        # --- BEGIN: Generated by ALSACONF, do not edit. ---
        # --- ALSACONF version $version ---
        alias char-major-116 snd
        alias snd-card-0 $CARD_DRIVER
        alias char-major-14 $SOUND_CORE
        alias sound-slot-0 snd-card-0
        alias sound-service-0-0 snd-mixer-oss
        alias sound-service-0-1 snd-seq-oss
        alias sound-service-0-3 snd-pcm1-oss
        alias sound-service-0-12 snd-pcm1-oss
        options snd snd_major=116 snd_cards_limit=1\
        snd_device_mode=$SND_MODE snd_device_gid=$SND_GID snd_device_uid=$SND_UID
        options $CARD_OPT
        # --- END: Generated by ALSACONF, do not edit. ---
        
</PRE>
<HR>
</LI>
</OL>
<P>
<H3><A NAME="alsa-conf binary"></A> Alsa-conf -- binary / library</H3>

<P>This would be replacement of previous shell version of alsaconf. It is
still in development state, accessible only through CVS-tree source. It
will be divided into two parts: library and configuration utility, so
other tool (i.e. YAST) could use the library. Coordinator of this part
of ALSA is 
<A HREF="ahermans@vf.telia.no">Anders Semb Hermansen</A>.
<P>Primary site: CVS-tree at
:pserver:anonymous@cvs.alsa-project.org:/home/alsa/cvsroot
<P><I>requires:</I> 
<A HREF="others-5.html#alsa-driver modules">alsa-driver modules</A><P><I>provides:</I> detecting pci sound-cards
<P>
<H2><A NAME="sndconfig"></A> <A NAME="ss1.2">1.2 Sndconfig (RedHat tool)</A>
</H2>

<P><I>requires:</I> Newt, kudzu (kudzu is the hardware auto-detection &amp;
configuration tool)
<P><I>provides:</I> auto-detection of the sound card, list of sound
cards.
<P>
<H3>User interface (info asked from the user)</H3>

<P>Some options from the following list depends on the selected sound card.
<OL>
<LI>I/O PORT</LI>
<LI>IRQ</LI>
<LI>8-bit DMA or DMA or DMA 1 and  DMA 2 or CONFIG I/O or
16-bit DMA</LI>
<LI>MPU I/O</LI>
<LI>MPU IRQ</LI>
<LI>CONTROL I/O</LI>
<LI>SB I/O</LI>
<LI>BASE MEMORY
        </LI>
</OL>
<P>
<H3>Which steps are presented to the user</H3>

<P>
<OL>
<LI>If the probe of the (PnP) sound card was enabled the
information about success (with appropriate detail) or
unsuccess is displayed.</LI>
<LI>If auto-detection fails (or not enabled), list of sound cards is
displayed.</LI>
<LI>Than ``edit settings'' follows with setting options
mentioned above.</LI>
<LI>If the file <CODE>/etc/conf.modules</CODE> exists it says,
the original file will be renamed to
<CODE>/etc/conf.modules.bak</CODE></LI>
<LI>Playing a sound sample with question ``Were you able to
hear the sample?''.</LI>
</OL>
<P>
<H3>The internals</H3>

<P>Steps made by sndconfig:
<OL>
<LI>Reading old card settings (it uses its special file and
even <CODE>/etc/conf.modules</CODE>).</LI>
<LI>Testing if <I>soundcore</I> module can be found
(otherwise continuing has no sense).</LI>
<LI>Finding available modules.</LI>
<LI>Probing PnP cards.</LI>
<LI>Getting card type from the list (if probe was
unsuccessful or disabled).</LI>
<LI>Editing sound card options (if autoconf for PnP enabled,
with appropriate detected values).</LI>
<LI>Saving settings to configuration files.</LI>
<LI>Testing the sound card and the configuration.</LI>
</OL>
<P>
<P>Main functions:
<DL>
<DT><B><CODE>static int EditSettings( int pnpprobe, struct
settings *set, struct settings *currset)</CODE></B><DD><P>User input of options enumarated above.
<P>
<DT><B><CODE>static int FindModule(char
*modulename)</CODE></B><DD><P>Tries to locate a module (in
<CODE>/lib/modules</CODE> directory).
<P>
<DT><B><CODE>int FindPnPCard( char **id, char **ansistr
)</CODE></B><DD><P>Parse <CODE>/sbin/pnpdump</CODE> output.
<P>
<DT><B><CODE>struct device ** probeDevices ( enum deviceClass
probeClass, enum deviceBus probeBus, int
probeFlags)</CODE></B><DD><P>Probe devices (part of kunzu).
<P>
<DT><B><CODE>static int ReadOldCardSettings</CODE></B><DD><P>Read files <CODE>/etc/conf.modules</CODE>,
<CODE>/etc/sysconfig/soundcard</CODE> for old card settings (made
with sndconfig).
<P>
<DT><B><CODE>static int TestSndCard(int dopnp, struct settings
*set)</CODE></B><DD><P>Tests the card by ``modprobing'' modules and playing a sample
sounds.
<P>
<DT><B><CODE>static int WriteCardSettings(struct settings
*set)</CODE></B><DD><P>Writes settings to a special (sndconfig only) file.
<P>
<DT><B><CODE>int WriteConfModules( struct settings *set
)</CODE></B><DD><P>Write settings to <CODE>/etc/conf.modules</CODE> file.
<P>
<DT><B><CODE>int WriteISAPnPConf( struct settings *set, char
*pnpid, int autoconfig )</CODE></B><DD><P>Writes <CODE>/etc/isapnp.conf</CODE> file.
</DL>
<P>
<HR>
<A HREF="others-2.html">Next</A>
Previous
<A HREF="others.html#toc1">Contents</A>
</BODY>
</HTML>
